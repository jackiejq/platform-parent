<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.slljr.finance.admin.mapper.UserAccountMapper">
  <resultMap id="BaseResultMap" type="com.slljr.finance.common.pojo.model.UserAccount">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="uid" jdbcType="INTEGER" property="uid" />
    <result column="cash_balance" jdbcType="DOUBLE" property="cashBalance" />
    <result column="integral_balance" jdbcType="DOUBLE" property="integralBalance" />
    <result column="agent_level_id" jdbcType="INTEGER" property="agentLevelId" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, `uid`, cash_balance, integral_balance, agent_level_id, `status`, create_time, 
    update_time
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from user_account
    where id = #{id,jdbcType=INTEGER}
  </select>

  <select id="selectByUid" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <include refid="Base_Column_List" />
    from user_account
    where uid = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from user_account
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" keyColumn="id" keyProperty="id" parameterType="com.slljr.finance.common.pojo.model.UserAccount" useGeneratedKeys="true">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into user_account (`uid`, cash_balance, integral_balance, 
      agent_level_id, `status`, create_time, 
      update_time)
    values (#{uid,jdbcType=INTEGER}, #{cashBalance,jdbcType=DOUBLE}, #{integralBalance,jdbcType=DOUBLE}, 
      #{agentLevelId,jdbcType=INTEGER}, #{status,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}, 
      #{updateTime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" keyColumn="id" keyProperty="id" parameterType="com.slljr.finance.common.pojo.model.UserAccount" useGeneratedKeys="true">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into user_account
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="uid != null">
        `uid`,
      </if>
      <if test="cashBalance != null">
        cash_balance,
      </if>
      <if test="integralBalance != null">
        integral_balance,
      </if>
      <if test="agentLevelId != null">
        agent_level_id,
      </if>
      <if test="status != null">
        `status`,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="uid != null">
        #{uid,jdbcType=INTEGER},
      </if>
      <if test="cashBalance != null">
        #{cashBalance,jdbcType=DOUBLE},
      </if>
      <if test="integralBalance != null">
        #{integralBalance,jdbcType=DOUBLE},
      </if>
      <if test="agentLevelId != null">
        #{agentLevelId,jdbcType=INTEGER},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.slljr.finance.common.pojo.model.UserAccount">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update user_account
    <set>
      <if test="uid != null">
        `uid` = #{uid,jdbcType=INTEGER},
      </if>
      <if test="cashBalance != null">
        cash_balance = #{cashBalance,jdbcType=DOUBLE},
      </if>
      <if test="integralBalance != null">
        integral_balance = #{integralBalance,jdbcType=DOUBLE},
      </if>
      <if test="agentLevelId != null">
        agent_level_id = #{agentLevelId,jdbcType=INTEGER},
      </if>
      <if test="status != null">
        `status` = #{status,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>

  <update id="updateByUid" parameterType="com.slljr.finance.common.pojo.model.UserAccount">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update user_account
    <set>
      <if test="cashBalance != null">
        cash_balance = #{cashBalance,jdbcType=DOUBLE},
      </if>
      <if test="integralBalance != null">
        integral_balance = #{integralBalance,jdbcType=DOUBLE},
      </if>
      <if test="agentLevelId != null">
        agent_level_id = #{agentLevelId,jdbcType=INTEGER},
      </if>
      <if test="status != null">
        `status` = #{status,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where `uid` = #{uid,jdbcType=INTEGER}
  </update>

  <update id="updateByPrimaryKey" parameterType="com.slljr.finance.common.pojo.model.UserAccount">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update user_account
    set `uid` = #{uid,jdbcType=INTEGER},
      cash_balance = #{cashBalance,jdbcType=DOUBLE},
      integral_balance = #{integralBalance,jdbcType=DOUBLE},
      agent_level_id = #{agentLevelId,jdbcType=INTEGER},
      `status` = #{status,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update>

  <select id="selectUserInviteCount" resultType="com.slljr.finance.common.pojo.vo.UserInviteCountVO">
    select
      uid,
      inviteCount
    from (
        SELECT
          ua.uid    AS uid,
          count(0)  AS inviteCount
        FROM user_account ua
        INNER JOIN user_basic ub ON ua.uid = ub.referer_uid
        WHERE ua.agent_level_id IS NOT NULL
        <if test="lastMonth">
          AND PERIOD_DIFF( date_format( now( ) , '%Y%m' ) , date_format( ub.create_time, '%Y%m' ) ) = 1
        </if>
        GROUP BY ua.uid
    ) temp where 1 = 1
    <if test="minCount != null">
      AND temp.inviteCount &gt;= #{minCount,jdbcType=INTEGER}
    </if>
    <if test="maxCount != null">
      AND temp.inviteCount &lt;= #{maxCount,jdbcType=INTEGER}
    </if>
  </select>

  <update id="batchUpdateAgentLevelByUids">
      update user_account
      set
        agent_level_id = #{agentLevelId,jdbcType=INTEGER},
        update_time = sysdate()
      where uid in
    <foreach collection="uids" item="listItem" open="(" separator="," close=")">
      #{listItem}
    </foreach>
  </update>

  <!--<update id="updateCashBalanceByUid" parameterType="com.slljr.finance.common.pojo.model.UserAccount">
    &lt;!&ndash;
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    &ndash;&gt;
    update user_account
    set cash_balance = cash_balance + #{cashBalance,jdbcType=DOUBLE},
    update_time = #{updateTime,jdbcType=TIMESTAMP}
    where uid = #{uid,jdbcType=INTEGER}
  </update>-->
</mapper>